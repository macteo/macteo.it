<!DOCTYPE html>
<!--#if expr="$HTTP_COOKIE=/fonts\-loaded=true/" -->
<html lang="en" class="fonts-loaded">
<!--#else -->
<html lang="en">
<!--#endif -->

<head>
  <meta charset="utf-8">
  <title>Blurred Rounded UIView</title>
  <link rel="canonical" href="http://0.0.0.0:4000/ios/2016/08/10/blurred-rounded-uiview.html">
  <link rel="alternate" title="Matteo Gavagnin" type="application/rss+xml" href="http://0.0.0.0:4000/feed.xml" />
  <link rel="alternate" title="Matteo Gavagnin" type="application/json" href="http://0.0.0.0:4000/feed.json" />
  <meta name="description" content="Matteo Gavagnin's personal website
">
  <meta name="author" content="Matteo Gavagnin">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
  <link rel="shortcut icon" href="/assets/images/favicon/favicon.ico" type="image/x-icon" />
  <link rel="mask-icon" href="/assets/images/favicon/favicon-pin.svg" color="#056BB1">
  <link rel="apple-touch-icon" sizes="57x57" href="/assets/images/favicon/dolomate-57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/assets/images/favicon/dolomate-60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/assets/images/favicon/dolomate-72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/assets/images/favicon/dolomate-76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/assets/images/favicon/dolomate-114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/assets/images/favicon/dolomate-120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/assets/images/favicon/dolomate-144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/assets/images/favicon/dolomate-152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/favicon/dolomate-180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/assets/images/favicon/dolomate-192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon/dolomate-32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/assets/images/favicon/dolomate-96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon/dolomate-16.png">
  <link rel="manifest" href="/assets/images/favicon/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/assets/images/favicon/dolomate-144.png">
  <meta name="theme-color" content="#ffffff">
  <script src="/assets/js/all.js"></script>
  <link rel="stylesheet" href="/assets/css/all.css">
  <link rel="stylesheet" href="/assets/css/raleway.css">
</head>


<body>
  <nav class="navbar">
  <ul class="navbar-list">
    <li class="navbar-item"><a class="navbar-link" href="/#interests">Interests</a></li>
    <li class="navbar-item"><a class="navbar-link" href="/#jobs">Jobs</a></li>
    <li class="navbar-item"><a class="navbar-link" href="/#products">Products</a></li>
    <li class="navbar-item"><a class="navbar-link" href="/blog">Blog</a></li>
  </ul>
</nav>

  <div class="container blog">
    <section class="header">
  <a href="/"><img src="/assets/images/macteo.jpg" class="profile small"/></a>
</section>

    <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    
    <h1 class="post-title" itemprop="name headline">Blurred Rounded UIView</h1>
    
    <p class="post-meta">
      <time
        datetime="2016-08-10T22:21:00+02:00"
        itemprop="datePublished"
        >Aug 10, 2016</time
      >
    </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>Maps and Apple Music apps in iOS 10 include a brand new way to present modal contents: a floating semi-modal view. Widgets and notifications have been redesigned to be presented with a similar shape.</p>

<blockquote>
  <p>Due to beta developer agreement I cannot share screenshots of those features. However you can have a look at them visiting the dedicated <a href="http://www.apple.com/ios/ios10-preview/">iOS 10 preview page</a> on Apple’s website.</p>
</blockquote>

<p>Unfortunately the technique used in iOS 8 and 9 to round the corner won’t work anymore: you’ll end up with rounded corners and a transparent background instead.</p>

<p>There’s an <a href="https://forums.developer.apple.com/message/159201#159201">entire thread</a> on Apple’s Developer Forums with motivations behind this change (you need to register as developer to read it).</p>

<p>However the trick is to avoid using <code class="highlighter-rouge">layer.mask</code> on the view that contains the <code class="highlighter-rouge">UIVisualEffectView</code> as subview or on the <code class="highlighter-rouge">UIVisualEffectView</code> itself as we used to do. Instead you are supposed to use <code class="highlighter-rouge">layer.maskView</code> or, if you just need rounded corners, the <code class="highlighter-rouge">layer.cornerRadius</code> property associated with <code class="highlighter-rouge">layer.masksToBounds = true</code>.</p>

<p>I’ve also found that if you try to add an external shadow to the container view’s layer, you’ll end up without blur. The trick is to set the shadow inside <code class="highlighter-rouge">func layoutSubiviews()</code> override method.</p>

<!--more-->

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">BlurredRoundedView</span><span class="p">:</span> <span class="kt">UIView</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">effectBackground</span> <span class="o">=</span> <span class="kt">UIVisualEffectView</span><span class="p">(</span><span class="nv">effect</span><span class="p">:</span> <span class="n">extraLightBlur</span><span class="p">)</span>

    <span class="kd">required</span> <span class="nf">init</span><span class="p">?(</span><span class="n">coder</span> <span class="nv">aDecoder</span><span class="p">:</span> <span class="kt">NSCoder</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">coder</span><span class="p">:</span> <span class="n">aDecoder</span><span class="p">)</span>
        <span class="nf">commonInit</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="nf">init</span><span class="p">(</span><span class="nv">frame</span><span class="p">:</span> <span class="kt">CGRect</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">frame</span><span class="p">:</span> <span class="n">frame</span><span class="p">)</span>
        <span class="nf">commonInit</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">commonInit</span><span class="p">()</span>  <span class="p">{</span>
        <span class="nf">initLayer</span><span class="p">()</span>
        <span class="nf">initEffectView</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">initLayer</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">backgroundColor</span> <span class="o">=</span> <span class="kt">UIColor</span><span class="o">.</span><span class="nf">clearColor</span><span class="p">()</span>
        <span class="n">layer</span><span class="o">.</span><span class="n">cornerRadius</span> <span class="o">=</span> <span class="n">cornerRadius</span>
        <span class="n">layer</span><span class="o">.</span><span class="n">masksToBounds</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">initEffectView</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">effectBackground</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">bounds</span>
        <span class="n">effectBackground</span><span class="o">.</span><span class="n">layer</span><span class="o">.</span><span class="n">cornerRadius</span> <span class="o">=</span> <span class="n">cornerRadius</span>
        <span class="n">effectBackground</span><span class="o">.</span><span class="n">layer</span><span class="o">.</span><span class="n">masksToBounds</span> <span class="o">=</span> <span class="kc">true</span>

        <span class="nf">addSubview</span><span class="p">(</span><span class="n">effectBackground</span><span class="p">)</span>
        <span class="nf">sendSubviewToBack</span><span class="p">(</span><span class="n">effectBackground</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">layoutSubviews</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">layoutSubviews</span><span class="p">()</span>
        <span class="k">let</span> <span class="nv">shadowPath</span> <span class="o">=</span> <span class="kt">UIBezierPath</span><span class="p">(</span><span class="nv">roundedRect</span><span class="p">:</span> <span class="n">bounds</span><span class="p">,</span> <span class="nv">cornerRadius</span><span class="p">:</span> <span class="n">cornerRadius</span><span class="p">)</span>
        <span class="n">layer</span><span class="o">.</span><span class="n">masksToBounds</span> <span class="o">=</span> <span class="kc">false</span>
        <span class="n">layer</span><span class="o">.</span><span class="n">shadowColor</span> <span class="o">=</span> <span class="kt">UIColor</span><span class="o">.</span><span class="nf">lightGrayColor</span><span class="p">()</span><span class="o">.</span><span class="kt">CGColor</span>
        <span class="n">layer</span><span class="o">.</span><span class="n">shadowOffset</span> <span class="o">=</span> <span class="kt">CGSizeMake</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">layer</span><span class="o">.</span><span class="n">shadowOpacity</span> <span class="o">=</span> <span class="mf">0.4</span>
        <span class="n">layer</span><span class="o">.</span><span class="n">shadowRadius</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">layer</span><span class="o">.</span><span class="n">shadowPath</span> <span class="o">=</span> <span class="n">shadowPath</span><span class="o">.</span><span class="kt">CGPath</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>I’ve prepared an <a href="/g/blurred-rounded-view.zip">Xcode playground</a> to show the final result.</p>

<p><img src="/assets/images/rounded-blurred-uiview.jpg#center320" alt="Final Rounded Blurred View" /></p>

<p>Once you know how to achieve the desired result, it’s really simple. Enjoy.</p>

  </div>
</article>

    <div class="docs-section" id="contacts">
  <h4 class="docs-header footer">Contacts</h4>
  <div class="row">
    <div class="three columns empty">
      &nbsp;
    </div>
    <div class="six columns">
      <center>
        <a href="https://twitter.com/macteo"><img src="/assets/images/icons/twitter.svg" class="logo-small" alt="twitter"/></a>
        <a href="https://telegram.me/macteog"><img src="/assets/images/icons/telegram.svg" class="logo-small" alt="telegram"/></a>
        <a href="https://github.com/macteo"><img src="/assets/images/icons/github.svg" class="logo-small" alt="github"/></a>
        <a href="mailto:m@macteo.it"><img src="/assets/images/icons/email.svg" class="logo-small" alt="email"/></a>
      </center>
    </div>
  </div>
  <div align="center">
    <sub>Leave this world a little better than you found it<a href="https://en.wikiquote.org/wiki/Robert_Baden-Powell"><sup>1</sup></a></sub>
  </div>
</div>
  </div>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-67703523-2', 'auto');
  ga('send', 'pageview');

</script>
</body>

</html>
